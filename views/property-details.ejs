<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title><%= property.title %> | My Pak Dharti</title>
  <style>
    * { 
      box-sizing: border-box; 
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Tahoma', sans-serif;
      background-color: #f8f9fa;
      line-height: 1.6;
      color: #333;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .property-layout {
      display: grid;
      grid-template-columns: 1fr 350px;
      gap: 30px;
      align-items: start;
    }

    /* Main Content Column */
    .main-content {
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    }

    /* Carousel Styles */
    .carousel {
      position: relative;
      overflow: hidden;
      height: 450px;
      background: #f5f5f5;
    }

    .carousel-images {
      display: flex;
      transition: transform 0.5s ease-in-out;
      height: 100%;
    }

    .carousel-images img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      flex-shrink: 0;
    }

    .carousel-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0, 0, 0, 0.7);
      color: white;
      border: none;
      padding: 12px 16px;
      cursor: pointer;
      font-size: 18px;
      border-radius: 4px;
      transition: background-color 0.3s;
      z-index: 10;
    }

    .carousel-btn:hover {
      background: rgba(0, 0, 0, 0.9);
    }

    .carousel-btn.left { left: 15px; }
    .carousel-btn.right { right: 15px; }

    /* Property Info Section */
    .property-info {
      padding: 25px;
    }

    .property-header {
      border-bottom: 1px solid #e9ecef;
      padding-bottom: 20px;
      margin-bottom: 25px;
    }

    .property-title {
      font-size: 28px;
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 8px;
      line-height: 1.3;
    }

    .property-location {
      color: #6c757d;
      font-size: 16px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
    }

    .property-location::before {
      content: "üìç";
      margin-right: 8px;
    }

    .property-status {
      display: inline-block;
      font-size: 12px;
      font-weight: bold;
      background: #28a745;
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .property-price {
      font-size: 32px;
      font-weight: bold;
      color: #27ae60;
      margin: 15px 0;
      display: flex;
      align-items: baseline;
    }

    .price-currency {
      font-size: 20px;
      margin-right: 5px;
    }

    /* Property Details Grid */
    .details-section {
      margin-bottom: 30px;
    }

    .section-title {
      font-size: 20px;
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 2px solid #27ae60;
      display: inline-block;
    }

    .property-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }

    .detail-box {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 20px 15px;
      text-align: center;
      transition: box-shadow 0.3s;
    }

    .detail-box:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .detail-label {
      color: #6c757d;
      font-size: 13px;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 5px;
    }

    .detail-value {
      color: #2c3e50;
      font-size: 16px;
      font-weight: bold;
    }

    /* Description Section */
    .description-section {
      background: #f8f9fa;
      padding: 25px;
      border-top: 1px solid #e9ecef;
      border-radius: 0 0 8px 8px;
    }

    .description-text {
      color: #555;
      font-size: 15px;
      line-height: 1.8;
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #e9ecef;
      margin-top: 15px;
    }

    /* Contact Sidebar */
    .contact-sidebar {
      position: sticky;
      top: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 15px rgba(0,0,0,0.1);
      padding: 25px;
    }

    .contact-header {
      text-align: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #e9ecef;
    }

    .contact-title {
      font-size: 18px;
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 5px;
    }

    .agent-info {
      text-align: center;
      margin-bottom: 25px;
    }

    .agent-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(45deg, #27ae60, #2ecc71);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 15px;
      font-size: 32px;
      color: white;
      font-weight: bold;
    }

    .agent-name {
      font-size: 18px;
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 5px;
    }

    .agent-role {
      color: #6c757d;
      font-size: 14px;
      text-transform: capitalize;
    }

    .contact-buttons {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .contact-button {
      padding: 14px 20px;
      border: none;
      border-radius: 6px;
      color: white;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      text-align: center;
      text-decoration: none;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      font-family: 'Tahoma', sans-serif;
    }

    .contact-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .contact-button::before {
      margin-right: 10px;
      font-size: 16px;
    }

    .whatsapp-btn { 
      background: #25D366; 
    }
    .whatsapp-btn:hover { 
      background: #1ebe57; 
    }
    .whatsapp-btn::before { 
      content: "üí¨"; 
    }

    .phone-btn { 
      background: #007bff; 
    }
    .phone-btn:hover { 
      background: #0056b3; 
    }
    .phone-btn::before { 
      content: "üìû"; 
    }

    .email-btn { 
      background: #6c757d; 
    }
    .email-btn:hover { 
      background: #5a6268; 
    }
    .email-btn::before { 
      content: "‚úâÔ∏è"; 
    }

    .contact-note {
      background: #e8f5e8;
      border: 1px solid #c3e6c3;
      border-radius: 6px;
      padding: 15px;
      margin-top: 20px;
      font-size: 13px;
      color: #155724;
      text-align: center;
    }

    .no-agent-info {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      border-radius: 6px;
      padding: 20px;
      color: #721c24;
      text-align: center;
      font-weight: bold;
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
      .property-layout {
        grid-template-columns: 1fr 320px;
        gap: 20px;
      }
    }

    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }

      .property-layout {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .contact-sidebar {
        position: static;
        order: -1;
      }

      .carousel {
        height: 300px;
      }

      .property-title {
        font-size: 24px;
      }

      .property-price {
        font-size: 26px;
      }

      .property-details {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }

      .detail-box {
        padding: 15px 10px;
      }

      .carousel-btn {
        padding: 10px 12px;
        font-size: 16px;
      }
    }

    @media (max-width: 480px) {
      .property-details {
        grid-template-columns: 1fr;
      }
      
      .contact-buttons {
        gap: 10px;
      }

      .contact-button {
        padding: 12px 16px;
        font-size: 13px;
      }
    }
  </style>
</head>
<body>
  <%- include('partials/header') %>

<div class="container">
  <div class="property-layout">
    
    <!-- Main Content Column -->
    <div class="main-content">
      
      <!-- Image Carousel -->
      <div class="carousel">
        <button class="carousel-btn left" onclick="moveSlide(-1)">&#10094;</button>
        <div class="carousel-images" id="carouselImages">
          <% if (Array.isArray(property.imageUrls)) { %>
            <% property.imageUrls.forEach(url => { %>
              <img src="<%= url %>" alt="Property Image">
            <% }) %>
          <% } else { %>
            <img src="<%= property.imageUrls %>" alt="Property Image">
          <% } %>
        </div>
        <button class="carousel-btn right" onclick="moveSlide(1)">&#10095;</button>
      </div>

      <!-- Property Information -->
      <div class="property-info">
        
        <!-- Property Header -->
        <div class="property-header">
          <h1 class="property-title"><%= property.title %></h1>
          <p class="property-location">
            <% 
              let locationParts = [];
              if (property.location) {
                locationParts = property.location.split(', ');
              } else {
                locationParts = [property.areaName, property.city, property.state].filter(Boolean);
              }
              let displayLocation = locationParts.reverse().join(', ');
            %>
            <%= displayLocation %>
          </p>
          <span class="property-status"><%= property.status %></span>
          <div class="property-price">
            <span class="price-currency">PKR</span>
            <%= property.price.toLocaleString() %>
          </div>
        </div>

        <!-- Property Details -->
        <div class="details-section">
          <h3 class="section-title">Property Details</h3>
          <div class="property-details">
            <div class="detail-box">
              <div class="detail-label">Type</div>
              <div class="detail-value"><%= property.type %></div>
            </div>
            <div class="detail-box">
              <div class="detail-label">Bedrooms</div>
              <div class="detail-value"><%= property.bedrooms %></div>
            </div>
            <div class="detail-box">
              <div class="detail-label">Bathrooms</div>
              <div class="detail-value"><%= property.bathrooms %></div>
            </div>
            <div class="detail-box">
              <div class="detail-label">Area</div>
              <div class="detail-value"><%= property.area %> sq ft</div>
            </div>
            <div class="detail-box">
              <div class="detail-label">Latitude</div>
              <div class="detail-value"><%= property.latitude %></div>
            </div>
            <div class="detail-box">
              <div class="detail-label">Longitude</div>
              <div class="detail-value"><%= property.longitude %></div>
            </div>
            <div class="detail-box">
              <div class="detail-label">Purpose</div>
              <div class="detail-value"><%= property.propertyPurpose %></div>
            </div>

            <!-- Local Area -->
            <% if (property.localArea) { %>
              <div class="detail-box">
                <div class="detail-label">Local Area</div>
                <div class="detail-value"><%= property.localArea %></div>
              </div>
            <% } %>

          </div>
        </div>

        <div class="details-section">
          <h3 class="section-title">Amenities</h3>
          <div class="property-details">
            <!-- Amenities (each in its own detail box) -->
            <% if (Array.isArray(property.amenities) && property.amenities.length > 0) { %>
              <% property.amenities.forEach(amenity => { %>
                <div class="detail-box">
                  <div class="detail-label">Amenity</div>
                  <div class="detail-value"><%= amenity %></div>
                </div>
              <% }); %>
            <% } %>
          </div>
        </div>

        <!-- Description -->
        <div class="details-section">
          <h3 class="section-title">Description</h3>
          <p class="description-text"><%= property.description %></p>
        </div>

      </div>

    </div>

    <!-- Contact Sidebar -->
    <div class="contact-sidebar">
      <% if (property.agent) { %>
        <div class="contact-header">
          <h3 class="contact-title">Contact for Details</h3>
        </div>

        <div class="agent-info">
          <div class="agent-avatar">
            <%= property.agent.name.charAt(0).toUpperCase() %>
          </div>
          <div class="agent-name"><%= property.agent.name %></div>
          <div class="agent-role"><%= property.agent.role === 'admin' ? 'Admin' : 'Agent' %></div>
        </div>

        <div class="contact-buttons">
          <% if (property.agent.phone) { %>
            <a href="https://wa.me/<%= property.agent.phone.replace(/[^0-9]/g, '') %>" 
               class="contact-button whatsapp-btn" target="_blank">
              Chat on WhatsApp
            </a>

            <a href="tel:<%= property.agent.phone %>" class="contact-button phone-btn">
              Call Now
            </a>
          <% } %>

          <% if (property.agent.email) { %>
            <a href="mailto:<%= property.agent.email %>" class="contact-button email-btn">
              Send Email
            </a>
          <% } %>
        </div>

        <div class="contact-note">
          üí° Get instant response via WhatsApp or call for immediate assistance
        </div>

      <% } else { %>
        <div class="no-agent-info">
          ‚ö†Ô∏è No agent information available for this property
        </div>
      <% } %>
    </div>

  </div>
</div>

<%- include('partials/footer') %>

  <script>
    let currentSlide = 0;
    const images = document.querySelectorAll("#carouselImages img");

    function moveSlide(n) {
      const totalSlides = images.length;
      if (totalSlides === 0) return;
      
      currentSlide = (currentSlide + n + totalSlides) % totalSlides;
      const offset = -currentSlide * 100;
      document.getElementById("carouselImages").style.transform = `translateX(${offset}%)`;
    }

    // Auto-slide functionality (optional)
    // setInterval(() => moveSlide(1), 5000);
  </script>
</body>
</html>